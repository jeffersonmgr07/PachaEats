<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pacha Eats</title>

  <style>
    :root{
      --brand:#e21f0c;
      --brand2:#ff5a1f;
      --bg:#f3f4f6;
      --text:#0f172a;
      --muted:#6b7280;
      --card:#fff;
      --stroke: rgba(15,23,42,.08);
      --shadow: 0 18px 38px rgba(15,23,42,.10);
      --shadow2: 0 10px 26px rgba(15,23,42,.12);
      --radius:18px;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      color:var(--text);
      background:
        radial-gradient(1200px 420px at 50% -80px, rgba(226,31,12,.16), transparent 60%),
        radial-gradient(900px 380px at 80% -80px, rgba(255,90,31,.12), transparent 60%),
        var(--bg);
    }
    a{color:inherit}
    img{max-width:100%;display:block}
    button{font-family:inherit}
    .container{width:min(1120px,92vw);margin:0 auto}
    main{padding:12px 0 44px}

    /* ===== TOPBAR ===== */
    .topbar{padding:14px 0 10px}
    .topbar-inner{
      display:flex;align-items:center;justify-content:space-between;gap:16px;
      padding:10px 14px;border-radius:999px;
      background: linear-gradient(180deg, rgba(226,31,12,.98), rgba(189,22,10,.98));
      box-shadow:0 18px 34px rgba(226,31,12,.22);
    }
    .brand{
      display:flex;align-items:center;gap:10px;min-width:190px
    }
    .brand .logo{
      width:44px;height:44px;border-radius:14px;overflow:hidden;
      display:grid;place-items:center;
      background: rgba(255,255,255,.16);
      border:1px solid rgba(255,255,255,.22);
      box-shadow:0 10px 18px rgba(0,0,0,.08) inset;
    }
    .brand .name{line-height:1.05;color:#fff;font-weight:950;letter-spacing:.2px}
    .brand .name span{display:block;font-weight:700;opacity:.92;font-size:12px;letter-spacing:.25px}
    .search{
      flex:1;display:flex;align-items:center;gap:10px;
      padding:10px 14px;border-radius:999px;
      background: rgba(255,255,255,.16);
      border:1px solid rgba(255,255,255,.22);
      color:#fff;min-width:260px
    }
    .search input{
      border:0;outline:0;width:100%;
      background:transparent;color:#fff;font-size:14px
    }
    .search input::placeholder{color: rgba(255,255,255,.78)}
    .top-actions{display:flex;align-items:center;gap:10px}
    .btn{
      appearance:none;
      border:1px solid rgba(255,255,255,.22);
      background: rgba(255,255,255,.16);
      color:#fff;font-weight:900;
      padding:10px 14px;border-radius:999px;
      cursor:pointer;display:inline-flex;align-items:center;gap:10px;
      text-decoration:none;
      transition: transform .18s ease, box-shadow .18s ease, filter .18s ease;
    }
    .btn:hover{transform: scale(1.03)}
    .cart-pill{position:relative;min-width:120px;justify-content:center}
    .cart-pill .count{
      position:absolute;top:-7px;right:-7px;
      width:22px;height:22px;border-radius:999px;display:grid;place-items:center;
      background:#fff;color:var(--brand);font-size:12px;font-weight:950;
      border:2px solid rgba(226,31,12,.85);
    }

    /* ===== HERO ===== */
    .hero{
      margin-top:10px;border-radius:var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.78), rgba(255,255,255,.86));
      border:1px solid var(--stroke);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .hero-inner{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:18px;
      padding:18px;
      align-items:center;
    }
    .hero h1{margin:0 0 8px;font-size: clamp(22px,2.6vw,34px);font-weight:950;letter-spacing:-.2px}
    .hero p{margin:0;color:var(--muted);max-width:62ch;font-size:14px;line-height:1.45}
    .hero-card{
      border-radius: calc(var(--radius) - 6px);
      background: linear-gradient(180deg, rgba(226,31,12,.09), rgba(255,90,31,.06));
      border: 1px solid rgba(226,31,12,.16);
      padding:14px;
      display:flex;flex-direction:column;gap:10px;
    }
    .hero-card .row{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .pill{
      display:inline-flex;align-items:center;gap:8px;
      padding:8px 10px;border-radius:999px;
      font-weight:900;font-size:12px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.88);
      color:var(--text);
    }
    .pill .dot{
      width:10px;height:10px;border-radius:999px;
      background:#16a34a;
      box-shadow:0 0 0 4px rgba(22,163,74,.12);
    }

    .section-head{
      display:flex;align-items:flex-end;justify-content:space-between;gap:12px;
      margin:16px 0 12px;
    }
    .section-head h2{margin:0;font-size: clamp(18px,2.2vw,26px);font-weight:950}
    .section-head p{margin:0;color:#374151;font-size:14px;max-width:70ch}

    /* ===== RESTAURANTES (CATS) ===== */
    .cats{
      display:flex;gap:10px;overflow:auto;padding:8px 4px;
      scroll-snap-type: x mandatory;
    }
    .cats::-webkit-scrollbar{height:10px}
    .cats::-webkit-scrollbar-thumb{background: rgba(15,23,42,.10);border-radius:999px}
    .cat-bubble{
      scroll-snap-align:start;
      min-width:170px;
      background: rgba(255,255,255,.88);
      border:1px solid var(--stroke);
      box-shadow: var(--shadow2);
      border-radius:16px;
      padding:12px 12px 10px;
      cursor:pointer;
      display:flex;align-items:center;justify-content:space-between;gap:12px;
      transition: transform .18s ease, box-shadow .18s ease, filter .18s ease;
    }
    .cat-bubble:hover{transform: scale(1.03)}
    .cat-bubble.active{
      border-color: rgba(226,31,12,.35);
      box-shadow: 0 18px 34px rgba(226,31,12,.14);
      background: linear-gradient(180deg, rgba(255,255,255,.92), rgba(255,255,255,.78));
    }
    .cat-bubble .label{font-weight:950;font-size:13px;line-height:1.1}
    .cat-bubble .img{
      width:46px;height:46px;border-radius:14px;
      background:#fff;border:1px solid var(--stroke);
      overflow:hidden;flex:0 0 auto;
      display:grid;place-items:center;
    }
    .cat-bubble .img img{width:100%;height:100%;object-fit:contain}

    /* ===== PRODUCT CAROUSEL ===== */
    .carousel-wrap{position:relative;margin-top:8px}
    .carousel{
      display:flex;gap:12px;overflow:auto;padding:8px 4px 14px;
      scroll-snap-type: x mandatory;
    }
    .carousel::-webkit-scrollbar{height:10px}
    .carousel::-webkit-scrollbar-thumb{background: rgba(15,23,42,.10);border-radius:999px}
    .car-btn{
      position:absolute;top:42%;transform:translateY(-50%);
      width:44px;height:44px;border-radius:999px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.92);
      box-shadow: var(--shadow2);
      cursor:pointer;
      display:grid;place-items:center;
      font-size:20px;font-weight:950;
      z-index:5;
    }
    .car-btn.left{left:-6px}
    .car-btn.right{right:-6px}
    .car-btn:hover{transform: translateY(-50%) scale(1.06)}

    .product-card{
      scroll-snap-align:start;
      min-width:210px;
      background: rgba(255,255,255,.92);
      border:1px solid var(--stroke);
      box-shadow: var(--shadow2);
      border-radius:18px;
      overflow:hidden;
      transition: transform .18s ease, box-shadow .18s ease, filter .18s ease;
    }
    .product-card:hover{transform: scale(1.02)}
    .product-img{aspect-ratio: 4/3;background: rgba(15,23,42,.04);border-bottom:1px solid rgba(15,23,42,.06)}
    .product-img img{width:100%;height:100%;object-fit:cover}
    .product-body{padding:12px;display:flex;flex-direction:column;gap:8px}
    .product-name{margin:0;font-weight:950;font-size:14px;line-height:1.15;min-height:34px}
    .product-meta{color:var(--muted);font-size:12px;margin-top:-2px}
    .product-price-row{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-top:4px}
    .product-price{font-weight:950;font-size:14px}
    .add-btn{
      border:0;cursor:pointer;font-weight:950;
      padding:10px 12px;border-radius:999px;color:#fff;
      background: linear-gradient(180deg, var(--brand2), var(--brand));
      box-shadow: 0 16px 28px rgba(226,31,12,.20);
      transition: transform .18s ease, box-shadow .18s ease, filter .18s ease;
    }
    .add-btn:hover{transform: scale(1.03)}
    .add-btn:disabled{opacity:.6;cursor:not-allowed;filter: grayscale(.2);box-shadow:none}

    /* ===== MODAL ===== */
    .modal{
      position:fixed;inset:0;background: rgba(2,6,23,.55);
      display:none;align-items:flex-end;justify-content:center;padding:12px;z-index:50;
    }
    .modal.open{display:flex}
    .sheet{
      width:min(560px,96vw);
      max-height:92vh;overflow:auto;
      border-radius:22px;
      background: rgba(255,255,255,.98);
      border: 1px solid rgba(255,255,255,.22);
      box-shadow: 0 30px 80px rgba(2,6,23,.35);
      padding:14px;position:relative;
      animation: up .18s ease-out;
    }
    @keyframes up{from{transform:translateY(14px);opacity:0}to{transform:translateY(0);opacity:1}}
    .sheet .close{
      position:absolute;top:10px;right:10px;width:40px;height:40px;border-radius:999px;
      border:1px solid var(--stroke);background: rgba(255,255,255,.92);
      cursor:pointer;font-size:16px;font-weight:950;display:grid;place-items:center;
      transition: transform .18s ease;
    }
    .sheet .close:hover{transform: scale(1.06)}
    .sheet-head{display:flex;align-items:flex-start;gap:12px;padding-right:46px;margin-bottom:10px}
    .sheet-head .thumb{
      width:86px;height:86px;border-radius:18px;overflow:hidden;
      border:1px solid rgba(15,23,42,.08);background: rgba(15,23,42,.04);flex:0 0 auto;
    }
    .sheet-head .thumb img{width:100%;height:100%;object-fit:cover}
    .sheet-head h3{margin:0;font-weight:950;font-size:18px;line-height:1.15}
    .sheet-head p{margin:6px 0 0;color:var(--muted);font-size:13px;line-height:1.35}

    .info-block{
      background: rgba(15,23,42,.03);
      border:1px solid rgba(15,23,42,.06);
      border-radius:18px;
      padding:12px;
      margin:10px 0;
    }
    .info-title{
      display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:10px;
    }
    .info-title h4{margin:0;font-weight:950;font-size:14px}
    .tag{
      font-size:11px;font-weight:950;padding:6px 9px;border-radius:999px;
      background: rgba(226,31,12,.10);
      border:1px solid rgba(226,31,12,.18);
      color: var(--brand);
      white-space:nowrap;
    }
    .opt{
      display:flex;align-items:flex-start;justify-content:space-between;gap:10px;
      padding:10px 10px;border-radius:14px;
      background: rgba(255,255,255,.9);
      border:1px solid rgba(15,23,42,.06);
      cursor:pointer;user-select:none;margin-bottom:8px;
      transition: transform .18s ease, box-shadow .18s ease, filter .18s ease;
    }
    .opt:hover{transform: scale(1.01)}
    .opt:last-child{margin-bottom:0}
    .opt .l{display:flex;align-items:flex-start;gap:10px}
    .radio{
      width:18px;height:18px;border-radius:999px;border:2px solid rgba(15,23,42,.28);
      margin-top:2px;display:grid;place-items:center;flex:0 0 auto;
    }
    .radio::after{
      content:"";width:10px;height:10px;border-radius:999px;background: var(--brand);
      transform: scale(0);transition: transform .14s ease;
    }
    .opt.selected .radio{border-color: rgba(226,31,12,.65)}
    .opt.selected .radio::after{transform: scale(1)}
    .opt .name{font-weight:950;font-size:13px;margin:0}
    .opt .desc{color:var(--muted);font-size:12px;margin:3px 0 0}
    .opt .r{font-weight:950;font-size:13px;white-space:nowrap}

    .qty-row{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-top:10px}
    .qty{
      display:flex;align-items:center;gap:10px;
      background: rgba(15,23,42,.03);
      border:1px solid rgba(15,23,42,.06);
      border-radius:999px;
      padding:8px 10px;
    }
    .qty button{
      width:34px;height:34px;border-radius:999px;
      border:1px solid rgba(15,23,42,.10);
      background: rgba(255,255,255,.95);
      cursor:pointer;font-weight:950;
    }
    .qty .n{font-weight:950;width:24px;text-align:center}
    .sheet-footer{
      display:flex;align-items:center;justify-content:space-between;gap:12px;margin-top:10px;
    }
    .sheet-footer .total{font-weight:950;font-size:16px}
    .sheet-footer .cta{
      border:0;cursor:pointer;font-weight:950;
      padding:12px 16px;border-radius:999px;color:#fff;
      background: linear-gradient(180deg, var(--brand2), var(--brand));
      box-shadow: 0 16px 28px rgba(226,31,12,.22);
      transition: transform .18s ease, box-shadow .18s ease, filter .18s ease;
    }
    .sheet-footer .cta:hover{transform: scale(1.03)}

    /* ===== FOOTER ===== */
    footer{padding:16px 0 26px;color: rgba(15,23,42,.60);font-size:12px;text-align:center}

    /* ===== WhatsApp float ===== */
    .wa-float{
      position:fixed;right:16px;bottom:16px;width:54px;height:54px;border-radius:999px;
      background:#22c55e;color:#fff;display:grid;place-items:center;
      box-shadow: 0 18px 34px rgba(34,197,94,.25);
      border:1px solid rgba(255,255,255,.25);
      text-decoration:none;z-index:80;
      transition: transform .18s ease;
    }
    .wa-float:hover{transform: scale(1.06)}

    @media (max-width:820px){
      .hero-inner{grid-template-columns:1fr}
      .brand{min-width:auto}
      .search{min-width:auto}
    }
  </style>
</head>

<body>
  <header class="topbar">
    <div class="container">
      <div class="topbar-inner">
        <div class="brand">
          <div class="logo"><img src="img/logos/pacha.png" alt="Pacha Eats"></div>
          <div class="name">Pacha Eats<span>Delivery + marcas</span></div>
        </div>

        <div class="search" role="search">
          <span style="font-weight:950; opacity:.9;">üîé</span>
          <input id="q" type="search" placeholder="Buscar productos‚Ä¶">
        </div>

        <div class="top-actions">
          <a class="btn" href="#restaurantes">Restaurantes</a>
          <button class="btn cart-pill" id="openCart" type="button">
            üõí Carrito
            <span class="count" id="cartCount">0</span>
          </button>
        </div>
      </div>
    </div>
  </header>

  <div class="container">
    <section class="hero">
      <div class="hero-inner">
        <div>
          <h1>Ordena de tus marcas favoritas</h1>
          <p>
            Pacha Eats re√∫ne varias marcas en un solo lugar. Selecciona un restaurante y mira sus mejores opciones.
          </p>
        </div>
        <div class="hero-card">
          <div class="row">
            <div class="pill">
              <span class="dot" id="openDot"></span>
              <span id="openText">Abierto</span>
            </div>
            <div class="pill">‚è± <span id="openHoursText">12:00 ‚Äì 23:00</span></div>
          </div>
          <div class="row">
            <div class="pill">üìç Pachacamac</div>
            <div class="pill">‚≠ê 5.0 (1,240)</div>
          </div>
        </div>
      </div>
    </section>

    <main>
      <section id="restaurantes">
        <div class="section-head">
          <div>
            <h2>Restaurantes</h2>
            <p>Elige una marca para ver sus mejores opciones.</p>
          </div>
        </div>

        <div class="cats" id="catsGrid" aria-label="Carrusel de restaurantes"></div>

        <div class="section-head" style="margin-top:14px;">
          <div>
            <h2>Productos</h2>
            <p>Explora y personaliza tus favoritos.</p>
          </div>
        </div>

        <div class="carousel-wrap">
          <button class="car-btn left" id="prodLeft" type="button" aria-label="Izquierda">‚Äπ</button>
          <div class="carousel" id="productCarousel" aria-label="Carrusel de productos"></div>
          <button class="car-btn right" id="prodRight" type="button" aria-label="Derecha">‚Ä∫</button>
        </div>
      </section>
    </main>

    <footer>
      ¬© <span id="year"></span> Pacha Eats ¬∑ Hecho con ‚ù§Ô∏è en Per√∫
    </footer>
  </div>

  <!-- Modal Personalizar -->
  <div class="modal" id="customModal" aria-hidden="true">
    <div class="sheet" role="dialog" aria-modal="true" aria-label="Personalizar producto">
      <button class="close" id="closeCustom" type="button">‚úï</button>

      <div class="sheet-head">
        <div class="thumb"><img id="mImg" src="" alt=""></div>
        <div>
          <h3 id="mTitle">Producto</h3>
          <p id="mDesc"></p>
        </div>
      </div>

      <div class="info-block" id="sizeBlock">
        <div class="info-title">
          <h4>Tama√±o</h4>
          <span class="tag">Obligatorio</span>
        </div>
        <div id="sizeList"></div>
      </div>

      <div class="info-block" id="toppingBlock">
        <div class="info-title">
          <h4>Complementos</h4>
          <span class="tag">Opcional</span>
        </div>
        <div id="toppingList"></div>
      </div>

      <div class="qty-row">
        <div class="qty">
          <button id="qtyMinus" type="button">‚àí</button>
          <div class="n" id="qtyN">1</div>
          <button id="qtyPlus" type="button">+</button>
        </div>
        <div style="color:var(--muted); font-size:12px;">Precio var√≠a seg√∫n opciones</div>
      </div>

      <div class="sheet-footer">
        <div class="total" id="mTotal">Total: S/ 0.00</div>
        <button class="cta" id="addToCartBtn" type="button">Agregar al carrito</button>
      </div>
    </div>
  </div>

  <!-- WhatsApp flotante -->
  <a class="wa-float" href="https://wa.me/51999999999" target="_blank" rel="noopener" aria-label="WhatsApp" title="WhatsApp">üí¨</a>

  <script>
  // ================== HELPERS ==================
  const $ = (sel, root=document) => root.querySelector(sel);
  const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));

  function money(n){
    return "S/ " + (Math.round(n*100)/100).toFixed(2);
  }
  function escapeHtml(str){
    return String(str ?? "")
      .replaceAll("&","&amp;").replaceAll("<","&lt;")
      .replaceAll(">","&gt;").replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }

  // ================== DATA: RESTAURANTES ==================
  const categories = [
    { id:"pacha-wok",      name:"Chifa",              img:"img/logos/restaurantes/Pacha Wok.png" },
    { id:"jijunas",        name:"Alitas y Burgers",   img:"img/logos/restaurantes/Jijunas.png" },
    { id:"delipizza",      name:"Pizzas",             img:"img/logos/restaurantes/Delipizza.png" },
    { id:"qori-chicken",   name:"Pollos y Parrillas", img:"img/logos/restaurantes/Qori Chicken.png" },
    { id:"pacha-fresh",    name:"Jugos y Sandwiches", img:"img/logos/restaurantes/Pacha Fresh.png" },
    { id:"pacha-gurmet",   name:"Criollo y Marino",   img:"img/logos/restaurantes/Pacha Gurmet.png" },
    { id:"dulces-rosita",  name:"Postres",            img:"img/logos/restaurantes/Dulces Rosita.png" },
  ];

  // ================== DATA: PRODUCTOS ==================
  // (Mantengo tu data original)
  const products = [
    { id:"p1", cat:"burg", name:"WHOPPER¬Æ", price:17.90, img:"https://images.unsplash.com/photo-1596662951482-0c4ba74a6df6?auto=format&fit=crop&w=1200&q=80" },
    { id:"p2", cat:"burg", name:"WHOPPER¬Æ Doble", price:22.90, img:"https://images.unsplash.com/photo-1568901346375-23c9450c58cd?auto=format&fit=crop&w=1200&q=80" },
    { id:"p3", cat:"burg", name:"King de Pollo", price:15.90, img:"https://images.unsplash.com/photo-1606755962773-d324e9a13086?auto=format&fit=crop&w=1200&q=80" },

    { id:"p4", cat:"pizza", name:"Pepperoni Mediana", price:32.00, img:"https://images.unsplash.com/photo-1548365328-9f547f6de0c0?auto=format&fit=crop&w=1200&q=80" },
    { id:"p5", cat:"pizza", name:"Hawaiana Mediana", price:34.00, img:"https://images.unsplash.com/photo-1541745537411-b8046dc6d66c?auto=format&fit=crop&w=1200&q=80" },

    { id:"p6", cat:"pollo", name:"1/2 Pollo a la Brasa", price:29.90, img:"https://images.unsplash.com/photo-1610057099443-fde8c4d50f91?auto=format&fit=crop&w=1200&q=80" },
    { id:"p7", cat:"pollo", name:"1 Pollo a la Brasa", price:49.90, img:"https://images.unsplash.com/photo-1621996346565-e3dbc646d9a9?auto=format&fit=crop&w=1200&q=80" },

    { id:"p8", cat:"chifa", name:"Chaufa Cl√°sico", price:17.90, img:"https://images.unsplash.com/photo-1604908554160-c5f89dd4e7a4?auto=format&fit=crop&w=1200&q=80" },
    { id:"p9", cat:"chifa", name:"Aeropuerto Mixto", price:21.90, img:"https://images.unsplash.com/photo-1586511925558-a4c6376fe65f?auto=format&fit=crop&w=1200&q=80" },

    { id:"p10", cat:"fresh", name:"Jugo Detox", price:12.00, img:"https://images.unsplash.com/photo-1542444459-db63c1a8e0c8?auto=format&fit=crop&w=1200&q=80" }
  ];

  // ================== TOP 10 POR RESTAURANTE (INDEX) ==================
  // Al elegir un restaurante, el carrusel de productos mostrar√° SOLO 10 items (curados por palabras clave).
  const FEATURE_RULES = {
    // Jijunas: alitas y costillitas
    "jijunas": (p) => /alita|alitas|costill/i.test(p.name || ""),
    // Pacha Wok: chaufas, aeropuertos y platos especiales
    "pacha-wok": (p) => /chaufa|aeropuerto|especial/i.test(p.name || ""),
    // Qori Chicken: ofertas / promos
    "qori-chicken": (p) => /oferta|ofertas|promo|promoci√≥n|promocion/i.test(p.name || ""),
  };

  function getTop10ForRestaurant(restId){
    const base = products.filter(p => p.cat === restId);
    if (!base.length) return [];

    const rule = FEATURE_RULES[restId];
    let featured = rule ? base.filter(rule) : base.slice();

    // Completar hasta 10 si el filtro dej√≥ pocos
    if (featured.length < 10) {
      const used = new Set(featured.map(x => x.id));
      for (const it of base) {
        if (featured.length >= 10) break;
        if (!used.has(it.id)) featured.push(it);
      }
    }

    return featured.slice(0, 10);
  }

  // ================== CART ==================
  let cart = [];

  // ================== OPEN/CLOSED (demo simple) ==================
  const OPEN_START = 12;
  const OPEN_END   = 23;

  function updateOpen(){
    const now = new Date();
    const h = now.getHours();
    const open = (h >= OPEN_START && h < OPEN_END);
    const dot = $("#openDot");
    const txt = $("#openText");
    dot.style.background = open ? "#16a34a" : "#dc2626";
    dot.style.boxShadow = open ? "0 0 0 4px rgba(22,163,74,.12)" : "0 0 0 4px rgba(220,38,38,.12)";
    txt.textContent = open ? "Abierto" : "Cerrado";
  }
  updateOpen();
  setInterval(updateOpen, 20000);

  // ================== STATE ==================
  let activeCat = categories[0]?.id || null;

  // ================== RENDER RESTAURANTES ==================
  function renderCats(){
    const root = $("#catsGrid");
    root.innerHTML = "";
    categories.forEach(c => {
      const el = document.createElement("div");
      el.className = "cat-bubble" + (c.id === activeCat ? " active" : "");
      el.innerHTML = `
        <div class="label">${escapeHtml(c.name)}</div>
        <div class="img"><img src="${c.img}" alt="${escapeHtml(c.name)}"></div>
      `;
      el.addEventListener("click", () => {
        activeCat = c.id;
        renderCats();
        renderProducts();
      });
      root.appendChild(el);
    });
  }

  // ================== PRODUCTOS ==================
  function productCardHTML(p){
    return `
      <article class="product-card">
        <div class="product-img">
          <img src="${p.img}" alt="${escapeHtml(p.name)}">
        </div>
        <div class="product-body">
          <p class="product-name">${escapeHtml(p.name)}</p>
          <div class="product-meta">Precio desde</div>
          <div class="product-price-row">
            <div class="product-price">${money(p.price)}</div>
            <button class="add-btn" type="button" data-open-custom="${p.id}">Agregar</button>
          </div>
        </div>
      </article>
    `;
  }

  // ‚úÖ CAMBIO PRINCIPAL: SOLO 10 AL SELECCIONAR RESTAURANTE
  function renderProducts(){
    const root = $("#productCarousel");

    // Mantiene tu l√≥gica original (filtrar por restaurante),
    // pero ahora muestra SOLO 10 productos ‚Äúdestacados‚Äù seg√∫n reglas.
    let use;

    if(activeCat){
      const top = getTop10ForRestaurant(activeCat);
      use = (top && top.length)
        ? top
        : products.filter(p => p.cat === activeCat).slice(0, 10);
    } else {
      // Sin restaurante seleccionado: deja el comportamiento original (todo)
      use = products;
    }

    root.innerHTML = use.map(productCardHTML).join("");

    root.querySelectorAll("[data-open-custom]").forEach(btn => {
      btn.addEventListener("click", () => {
        const id = btn.getAttribute("data-open-custom");
        const p = products.find(x => x.id === id);
        if(!p) return;
        openCustomize(p, btn);
      });
    });
  }

  // ================== MODAL PERSONALIZAR ==================
  const sizeDefs = [
    { id:"reg", name:"Regular", add:0.00, desc:"+0.00" },
    { id:"gde", name:"Grande", add:3.50, desc:"+S/ 3.50" }
  ];
  const toppingDefs = [
    { id:"cheese", name:"Queso extra", add:2.50, desc:"+S/ 2.50" },
    { id:"bacon", name:"Bacon", add:3.00, desc:"+S/ 3.00" },
    { id:"salsa", name:"Salsa picante", add:1.50, desc:"+S/ 1.50" },
    { id:"papas", name:"Papas extra", add:4.00, desc:"+S/ 4.00" }
  ];

  let customProduct = null;
  let customQty = 1;
  let selectedSize = "reg";
  let selectedToppings = new Set();
  let lastTriggerEl = null;

  function openCustomize(p, triggerEl){
    customProduct = p;
    customQty = 1;
    selectedSize = "reg";
    selectedToppings = new Set();
    lastTriggerEl = triggerEl || null;

    $("#mImg").src = p.img;
    $("#mImg").alt = p.name;
    $("#mTitle").textContent = p.name;
    $("#mDesc").textContent = p.desc || "Personaliza tu pedido y agr√©galo al carrito.";

    $("#qtyN").textContent = customQty;

    const sizeRoot = $("#sizeList");
    sizeRoot.innerHTML = "";
    sizeDefs.forEach(s => {
      const el = document.createElement("div");
      el.className = "opt" + (s.id === selectedSize ? " selected" : "");
      el.innerHTML = `
        <div class="l">
          <div class="radio"></div>
          <div>
            <p class="name">${escapeHtml(s.name)}</p>
            <p class="desc">${escapeHtml(s.desc)}</p>
          </div>
        </div>
        <div class="r">${s.add ? "+" + money(s.add) : "+0.00"}</div>
      `;
      el.addEventListener("click", () => {
        selectedSize = s.id;
        $$(".opt", sizeRoot).forEach(x => x.classList.remove("selected"));
        el.classList.add("selected");
        updateModalTotal();
      });
      sizeRoot.appendChild(el);
    });

    const topRoot = $("#toppingList");
    topRoot.innerHTML = "";
    toppingDefs.forEach(t => {
      const el = document.createElement("div");
      el.className = "opt";
      el.innerHTML = `
        <div class="l">
          <div class="radio"></div>
          <div>
            <p class="name">${escapeHtml(t.name)}</p>
            <p class="desc">${escapeHtml(t.desc)}</p>
          </div>
        </div>
        <div class="r">+${money(t.add)}</div>
      `;
      el.addEventListener("click", () => {
        const on = selectedToppings.has(t.id);
        if(on){ selectedToppings.delete(t.id); el.classList.remove("selected"); }
        else { selectedToppings.add(t.id); el.classList.add("selected"); }
        updateModalTotal();
      });
      topRoot.appendChild(el);
    });

    updateModalTotal();
    $("#customModal").classList.add("open");
    $("#customModal").setAttribute("aria-hidden","false");
  }

  function closeCustomize(){
    $("#customModal").classList.remove("open");
    $("#customModal").setAttribute("aria-hidden","true");
    customProduct = null;
    lastTriggerEl?.focus?.();
  }

  function computeLineTotal(){
    if(!customProduct) return 0;
    const base = customProduct.price || 0;
    const sizeAdd = (sizeDefs.find(x => x.id === selectedSize)?.add) || 0;

    let topAdd = 0;
    for(const tid of selectedToppings){
      topAdd += (toppingDefs.find(x => x.id === tid)?.add) || 0;
    }
    return (base + sizeAdd + topAdd) * customQty;
  }

  function updateModalTotal(){
    $("#qtyN").textContent = customQty;
    $("#mTotal").textContent = "Total: " + money(computeLineTotal());
  }

  $("#qtyMinus").addEventListener("click", () => {
    customQty = Math.max(1, customQty - 1);
    updateModalTotal();
  });
  $("#qtyPlus").addEventListener("click", () => {
    customQty = Math.min(20, customQty + 1);
    updateModalTotal();
  });

  $("#closeCustom").addEventListener("click", closeCustomize);
  $("#customModal").addEventListener("click", (e) => {
    if(e.target === $("#customModal")) closeCustomize();
  });
  window.addEventListener("keydown", (e) => {
    if(e.key === "Escape" && $("#customModal").classList.contains("open")) closeCustomize();
  });

  $("#addToCartBtn").addEventListener("click", () => {
    if(!customProduct) return;

    const size = sizeDefs.find(x => x.id === selectedSize);
    const tops = Array.from(selectedToppings).map(id => toppingDefs.find(x => x.id === id)).filter(Boolean);

    const line = {
      id: "line_" + Date.now(),
      pid: customProduct.id,
      name: customProduct.name,
      qty: customQty,
      priceBase: customProduct.price,
      size: size ? { id:size.id, name:size.name, add:size.add } : null,
      toppings: tops.map(t => ({ id:t.id, name:t.name, add:t.add })),
      total: computeLineTotal()
    };

    cart.push(line);
    renderCartBadge();
    closeCustomize();
  });

  // ================== CART BADGE ==================
  function renderCartBadge(){
    const count = cart.reduce((a, it) => a + (it.qty || 0), 0);
    $("#cartCount").textContent = String(count);
  }
  $("#openCart").addEventListener("click", () => {
    if(!cart.length){
      alert("Tu carrito est√° vac√≠o.");
      return;
    }
    const sum = cart.reduce((a, it) => a + (it.total || 0), 0);
    alert("Items: " + cart.length + "\\nTotal: " + money(sum));
  });

  // ================== BUSCADOR (tu l√≥gica original) ==================
  $("#q").addEventListener("input", (e) => {
    const q = e.target.value.trim().toLowerCase();
    if(!q){
      renderProducts();
      return;
    }
    const root = $("#productCarousel");
    const base = products.filter(p => p.cat === activeCat);
    const filtered = base.filter(p => (p.name).toLowerCase().includes(q));
    root.innerHTML = (filtered.length ? filtered : base).map(productCardHTML).join("");
    root.querySelectorAll("[data-open-custom]").forEach(btn => {
      btn.addEventListener("click", () => {
        const id = btn.getAttribute("data-open-custom");
        const p = products.find(x => x.id === id);
        if(!p) return;
        openCustomize(p, btn);
      });
    });
  });

  // ================== CAROUSEL CONTROLS ==================
  function scrollCar(root, dir=1){
    const amount = Math.max(220, root.clientWidth * 0.82);
    root.scrollBy({ left: dir * amount, behavior:"smooth" });
  }
  $("#prodLeft").addEventListener("click", () => scrollCar($("#productCarousel"), -1));
  $("#prodRight").addEventListener("click", () => scrollCar($("#productCarousel"),  1));

  // ================== INIT ==================
  renderCats();
  renderProducts();
  renderCartBadge();
  $("#year").textContent = String(new Date().getFullYear());
  </script>
</body>
</html>
